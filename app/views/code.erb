<div class="codepage">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/languages/ruby.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>

<h1>Here is your code!</h1>
<h6><a href="/">Head back to the homepage</a></h6>

<div class="models-view">
<h2>Models</h2>

<%@tables.each do |table|%>

	<%if table.name.include?("_") == false%>
	<h3 style="display: inline;"><%=table.name%> Model</h3><br>
	<h5 style="display: inline;">(consider naming this model file <%=table.name.singularize%>.rb)</h5>

	<pre><code class="ruby">class <%=table.name.singularize%> < ActiveRecord::Base<%if @associations.where(target_id: table.id)%><%relevant_rel = @associations.where(target_id: table.id)%><%relevant_rel.each do |rel| %><%if rel.connector == "NA" && rel.assoc != "has_belongs_many"%>
	belongs_to :<%=(@tables.find(rel.origin_id)).name.downcase.singularize%><%end%><%if rel.assoc == "has_belongs_many" && rel.connector == "NA"%>
	has_and_belongs_to_many :<%=(@tables.find(rel.origin_id)).name.downcase%><%end%><%if rel.assoc == "has_many_poly"%>
	has_many :<%=(@tables.find(rel.origin_id)).name.downcase%>, as <%=(@tables.find(rel.origin_id)).columns.where(polymorphic?: 1).name%><%end%><%end%><%end%><%if @associations.where(origin_id: table.id)%><%relevant_rel = @associations.where(origin_id: table.id)%><%relevant_rel.each do |rel| %><%if rel.assoc == "has_one" && rel.connector == "NA"%>
	has_one :<%=(@tables.find(rel.target_id)).name.downcase.singularize%><%end%><%if rel.assoc == "has_one" && rel.connector == "through"%>
	has_one :<%=(@tables.find(rel.target_id)).name.downcase.singularize%>, through: :<%=(@tables.find(rel.channel_id)).name.downcase.singularize%><%end%><%if rel.assoc == "has_many" && rel.connector == "NA"%>
	has_many :<%=(@tables.find(rel.target_id)).name.downcase%><%end%><%if rel.assoc == "has_many" && rel.connector == "through"%>
	has_many :<%=(@tables.find(rel.target_id)).name.downcase%>, through: :<%=(@tables.find(rel.channel_id)).name.downcase%><%end%><%if rel.assoc == "has_belongs_many" && rel.connector == "NA"%>
	has_and_belongs_to_many :<%=(@tables.find(rel.target_id)).name.downcase%><%end%><%if rel.assoc == "has_many_poly"%>
	belongs_to :<%=(@tables.find(rel.origin_id)).columns.where(polymorphic?: 1).name%>, polymorphic: true<%end%><%end%><%end%>
	<%table.columns.each do |col|%><%if col.presence? == 1 && col.unique? == 1%>
	validates :<%=col.name%>, presence: true, uniqueness: true<%elsif col.presence? == 1%>
	validates :<%=col.name%>, presence: true<%elsif col.unique? == 1%>
	validates :<%=col.name%>, uniqueness: true<%end%><%end%>
end</code></pre>
	<%end%>

<%end%>

</div>

<div class="migrations-view">

<h2>Migrations</h2>

<%@tables.each do |table|%>

	<h3 style="display: inline;"><%=table.name%> Migration</h3><br> 
	<h5 style="display: inline;">(consider naming this table in the migration 'create_<%=table.name.downcase%>_table' -- note the first line of the below follows this convention)</h5>

	<%if table.name.include?"_"%>
		<% array = table.name.split("_") %>
		<% array[1].capitalize! %>
		<% table_name = array.join("") %>
	<%else%>
		<% table_name = table.name.capitalize%>
	<%end%>

	<pre><code class="ruby">class Create<%=table_name%>Table < ActiveRecord::Migration
	def change
		create_table :<%=table.name.downcase%><%if table.name.include?("_")%>, id: false<%end%> do |t|<%table.columns.each do |col|%>
			t.<%=col.category%> :<%=col.name%><%if col.foreignkey? == 1%>, index: true<%end%><%end%>
			<%if table.name.include?("_") == false%>t.timestamps null: false<%end%>
		end
	end
end</code></pre>

<%end%>

</div>

</div>
<script>hljs.initHighlightingOnLoad();</script>
